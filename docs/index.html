<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok</title><meta name="description" content="Documentation for ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok</h2></div>
<div class="tsd-panel tsd-typography"><p><a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok/actions/workflows/tests.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok/actions/workflows/tests.yml/badge.svg" alt="Tests"></a>
<a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok/badge.svg?branch=main" alt="Coverage Status"></a>
<a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2223_ull-esit-inf-dsi-22-23-prct12-destravate-api-grupok&metric=alert_status" alt="Quality Gate Status"></a></p>

<a href="#práctica-12---destravate-api-nodeexpress---grupo-k" id="práctica-12---destravate-api-nodeexpress---grupo-k" style="color: inherit; text-decoration: none;">
  <h1>Práctica 12 - Destravate: API Node/Express - Grupo K</h1>
</a>
<p>Esta práctica consiste en desarrollar una API REST con Node.js y Express para la aplicación Destravate. Esta API se encargará de gestionar los datos de la aplicación, ofreciendo todas las operaciones CRUD, almacenándolos en una base de datos MongoDB, implementado utilizando mongoose.</p>

<a href="#funcionalidad-de-la-api" id="funcionalidad-de-la-api" style="color: inherit; text-decoration: none;">
  <h2>Funcionalidad de la API</h2>
</a>
<p>La API debe ofrecer distintas funcionalidades, para los distintos puntos de acceso o rutas de esta. La api se basa en el seguimiento de actividades deportivas, por lo que se ofrecerán funcionalidades para gestionar usuarios, grupos, retos y rutas. Para cada uno de estos elementos se ofrecerán las operaciones CRUD. Algo común en todos es que la operación de consulta, modificación y borrado se puede realizar de dos formas, o bien utilizando una query string por el nombre de lo que se consulte, o bien utilizando el id único de dicho elemento como parametro de la ruta de acceso.</p>
<ul>
<li><a href="http://localhost:3000/users?name=ejemplo">http://localhost:3000/users?name=ejemplo</a> -&gt; Consulta de usuarios por nombre</li>
<li><a href="http://localhost:3000/users/5f9e9b0a1c9d440000d1b0b0">http://localhost:3000/users/5f9e9b0a1c9d440000d1b0b0</a> -&gt; Consulta de usuarios por id único</li>
</ul>

<a href="#track" id="track" style="color: inherit; text-decoration: none;">
  <h3>Track</h3>
</a>
<p>Las operaciones con las rutas (deportivas) se realizarán a través de la ruta /tracks, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Estas rutas se caracterizan por tener los siguientes atributos o información:</p>
<ul>
<li>ID único de la ruta (valor generado automáticamente por el sistema).</li>
<li>Nombre de la ruta.</li>
<li>Geolocalización del inicio (coordenadas).</li>
<li>Geolocalización del final de la ruta (coordenadas).</li>
<li>Longitud de la ruta en kilómetros.</li>
<li>Desnivel medio de la ruta.</li>
<li>Usuarios que han realizado la ruta (IDs).</li>
<li>Tipo de actividad: Indicador si la ruta se puede realizar en bicicleta o corriendo.</li>
<li>Calificación media de la ruta.</li>
</ul>

<a href="#user" id="user" style="color: inherit; text-decoration: none;">
  <h3>User</h3>
</a>
<p>Las operaciones con los usuarios se realizarán a través de la ruta /users, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Estos usuarios se caracterizan por tener los siguientes atributos o información:</p>
<ul>
<li>ID único del usuario (valor generado automáticamente por el sistema).</li>
<li>Nombre del usuario.</li>
<li>Actividades que realiza: Correr o bicicleta.</li>
<li>Amigos en la aplicación: Colleción de IDs de usuarios con los que interacciona.</li>
<li>Grupos de amigos: Diferentes colecciones de IDs de usuarios con los que suele realizar rutas.</li>
<li>Estadísticas de entrenamiento: Cantidad de km y desnivel total acumulados en la semana, mes y año.</li>
<li>Rutas favoritas: IDs de las rutas que el usuario ha realizado con mayor frecuencia.</li>
<li>Retos activos: IDs de los retos que el usuario está realizando actualmente.</li>
<li>Histórico de rutas: Los usuarios deben almacenar el historial de rutas realizadas desde que se registraron en el sistema. La información almacenada en esta estructura de datos deberá contener la información de la fecha y el ID de la ruta realizada. Nótese que un usuario puede realizar más de una ruta al día y está decisión puede afectar al tipo de estructura en el que se almacena la información.</li>
</ul>

<a href="#group" id="group" style="color: inherit; text-decoration: none;">
  <h3>Group</h3>
</a>
<p>Las operaciones con los grupos se realizarán a través de la ruta /groups, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Estos grupos se caracterizan por tener los siguientes atributos o información:</p>
<ul>
<li>ID único del grupo (valor generado automáticamente por el sistema).</li>
<li>Nombre del grupo.</li>
<li>Participantes: IDs de los miembros del grupo.</li>
<li>Estadísticas de entrenamiento grupal: Cantidad de km y desnivel total acumulados de manera grupal en la semana, mes y año</li>
<li>Clasificación de los usuarios: Ranking de los usuarios que más entrenamientos han realizado históricamente dentro del grupo, es decir, ordenar los usuarios por la cantidad de km totales o desnivel total que han acumulado.</li>
<li>Rutas favoritas del grupo: Rutas que los usuarios del grupo han realizado con mayor frecuencia en sus salidas conjuntas.</li>
<li>Histórico de rutas realizadas por el grupo: Información similar que almacenan los usuarios pero en este caso referente a los grupos. Nótese que un usuario puede realizar rutas con un grupo y/o de manera individual el mismo día. Es decir, a modo de simplificación, asumimos que todos los usuarios de un grupo realizan la actividad cuando se planifica. Aunque, también pueden realizar otras actividades de manera individual.</li>
</ul>

<a href="#challenge" id="challenge" style="color: inherit; text-decoration: none;">
  <h3>Challenge</h3>
</a>
<p>Las operaciones con los retos se realizarán a través de la ruta /challenges, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Estos retos se caracterizan por tener los siguientes atributos o información:</p>
<ul>
<li>ID único del reto (valor generado automáticamente por el sistema).</li>
<li>Nombre del reto.</li>
<li>Rutas que forman parte del reto.</li>
<li>Tipo de actividad del reto: bicicleta o correr.</li>
<li>Km totales a realizar (como la suma de los kms de las rutas que lo engloban).</li>
<li>Usuarios que están realizando el reto.</li>
</ul>

<a href="#implementación-y-estructura-de-la-api-rest" id="implementación-y-estructura-de-la-api-rest" style="color: inherit; text-decoration: none;">
  <h2>Implementación y estructura de la API REST</h2>
</a>
<p>Lo primero a comentar es la organización y estructura del código, dentro de la carpeta src/ se encuentra todo el código fuente del proyecto, hemos decidido crear un directorio para cada grupo de ficheros relacionados para una mejor organización. En este caso, tenemos los siguientes directorios:</p>
<ul>
<li>enums: En este directorio se encuentran los enumerados que se utilizan en la api.</li>
<li>interfaces: En este directorio se encuentran las interfaces que se utilizan en la api.</li>
<li>models: En este directorio se encuentran los modelos de datos que se utilizan en la api.</li>
<li>routes: En este directorio se encuentran los directorios para cada una de las rutas de la api.</li>
<li>db: En este directorio se encuentran los ficheros relacionados con la base de datos.</li>
</ul>
<p>En cuanto a esta última carpeta, db/, se encuentran los ficheros relacionados con la base de datos. En este caso solo es uno, llamado <code>mongoose.ts</code> en este simplemente se realiza la conexión con la base de datos.</p>
<p>Además de todo esto, hay dos ficheros más en la raíz del proyecto, <code>app.ts</code> y <code>index.ts</code>. En el primero se encuentra la configuración del servidor express, en este caso lo único que hay son las distintas rutas de la api que se utilizan. En el segundo se encuentra el punto de entrada de la aplicación, es decir donde se inicia el servidor express para que escuche peticiones a traves del puerto determinado.</p>
<p>El puerto a utilizar se determina según el entorno en el que se ejecute la aplicación, la configuración de estos entornos se encuentra en los distintos ficheros <code>.env</code> que se encuentran en la carpeta &#39;config/&#39; en la raíz del proyecto. En estos ficheros se encuentran las variables de entorno que se utilizan en la aplicación, en este caso solo tenemos el puerto y la url de conexión a la base de datos.</p>
<p>Ahora se comentará cada uno de los ficheros dentro de los directorios comentados anteriormente.</p>

<a href="#enums" id="enums" style="color: inherit; text-decoration: none;">
  <h3>Enums</h3>
</a>

<a href="#activityenumts" id="activityenumts" style="color: inherit; text-decoration: none;">
  <h4>activityEnum.ts</h4>
</a>
<p>Este enumerado es simplemente para los tipos de actividades que tienen las rutas, estos son solo dos, correr y bicicleta, que los hemos representado en ingles como running y cycling. </p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">enum</span><span class="hl-1"> </span><span class="hl-3">ActivityEnum</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">running</span><span class="hl-1"> = </span><span class="hl-5">&#39;running&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">cycling</span><span class="hl-1"> = </span><span class="hl-5">&#39;cycling&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Simplemente se utiliza para que el usuario no pueda introducir otro tipo de actividad que no sea una de estas dos.</p>

<a href="#interfaces" id="interfaces" style="color: inherit; text-decoration: none;">
  <h3>Interfaces</h3>
</a>

<a href="#historyinterface" id="historyinterface" style="color: inherit; text-decoration: none;">
  <h4>HistoryInterface</h4>
</a>
<p>Esta interfaz es para el histórico de rutas de los usuarios y grupos, como se ha comentado anteriormente, esta interfaz tiene dos atributos, el id de la ruta y la fecha en la que se realizó.</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">HistoryData</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">track</span><span class="hl-1">: </span><span class="hl-3">Schema</span><span class="hl-1">.</span><span class="hl-3">Types</span><span class="hl-1">.</span><span class="hl-3">ObjectId</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">date</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Vemos que el id de la ruta es de tipo <code>Schema.Types.ObjectId</code>, esto es porque en la base de datos se almacena como un id único de tipo <code>ObjectId</code>, que es un tipo de dato que proporciona mongoose para identificar de manera única los documentos de la base de datos.</p>

<a href="#trainingstatisticsinterface" id="trainingstatisticsinterface" style="color: inherit; text-decoration: none;">
  <h4>TrainingStatisticsInterface</h4>
</a>
<p>Esta interfaz es para las estadísticas de entrenamiento de los usuarios y grupos, como se ha comentado anteriormente, esta interfaz tiene tres atributos, uno para las estadísticas de la semana, otro para las del mes y otro para las del año. Cada uno de estos atributos tiene dos atributos, uno para los kilómetros y otro para el desnivel acumulado.</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">TrainingStatisticsInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">week</span><span class="hl-1">: { </span><span class="hl-6">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-6">elevationGain</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-6">month</span><span class="hl-1">: { </span><span class="hl-6">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-6">elevationGain</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">  </span><span class="hl-6">year</span><span class="hl-1">: { </span><span class="hl-6">km</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">; </span><span class="hl-6">elevationGain</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#models" id="models" style="color: inherit; text-decoration: none;">
  <h3>Models</h3>
</a>
<p>Para cada una de las rutas de la api, se ha creado un modelo de datos, se debe crear una interfaz para dicho modelo y un esquema de mongoose. </p>

<a href="#track-1" id="track-1" style="color: inherit; text-decoration: none;">
  <h4>Track</h4>
</a>
<p>La interfaz diseñada para una ruta es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">startCoordinates</span><span class="hl-1">: [</span><span class="hl-3">number</span><span class="hl-1">, </span><span class="hl-3">number</span><span class="hl-1">]; </span><span class="hl-7">// [lat, long]</span><br/><span class="hl-1">  </span><span class="hl-6">endCoordinates</span><span class="hl-1">: [</span><span class="hl-3">number</span><span class="hl-1">, </span><span class="hl-3">number</span><span class="hl-1">]; </span><span class="hl-7">// [lat, long]</span><br/><span class="hl-1">  </span><span class="hl-6">length</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">grade</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: [</span><span class="hl-3">UserDocumentInterface</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">rating</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>En este caso, el id de los usuarios que han realizado la ruta se almacena como un array de usuarios, usando la interfaz de usuario que se ha creado y se comentará más adelante. Además, el tipo de actividad es el enumerado que se ha comentado anteriormente, otra cosa a resaltar es que las cordeenadas se almacenan como un array de dos elementos, el primero es la latitud y el segundo la longitud.</p>
<p>El esquema de mongoose para este modelo es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">trackSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-8">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">startCoordinates:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Number</span><span class="hl-1">, </span><span class="hl-6">Number</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">endCoordinates:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Number</span><span class="hl-1">, </span><span class="hl-6">Number</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">length:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid length: </span><span class="hl-2">${</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">grade:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1"> &gt;= </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid grade: </span><span class="hl-2">${</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type :</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-6">enum :</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-8">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">rating:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1"> &gt;= </span><span class="hl-9">0</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">val</span><span class="hl-1"> &lt;= </span><span class="hl-9">5</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid rating: </span><span class="hl-2">${</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Viendo punto por punto, comenzando por el atributo <code>name</code>, vemos que es de tipo <code>String</code>, que es requerido, que se le aplica un <code>trim</code> para eliminar los espacios en blanco al principio y al final y que es único, osea que no puede existir un track en la base de datos con el mismo nombre que otro. Los atributos <code>startCoordinates</code> y <code>endCoordinates</code> son de tipo <code>Number</code> y son requeridos. El atributo <code>length</code> es de tipo <code>Number</code>, es requerido y se le aplica una validación para que el valor sea mayor que 0. El atributo <code>grade</code> es de tipo <code>Number</code>, es requerido y se le aplica una validación para que el valor sea mayor o igual que 0. El atributo <code>users</code> es de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de usuarios, es requerido y por defecto es un array vacío. El atributo <code>activity</code> es de tipo <code>String</code>, es requerido y se le aplica una validación para que el valor sea uno de los valores del enumerado <code>Activity</code>. El atributo <code>rating</code> es de tipo <code>Number</code>, es requerido y se le aplica una validación para que el valor sea mayor o igual que 0 y menor o igual que 5.</p>
<p>Por ultimo en este fichero se exporta el modelo de datos de la siguiente manera:</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1"> = </span><span class="hl-8">model</span><span class="hl-1">&lt;</span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">, </span><span class="hl-6">trackSchema</span><span class="hl-1">);</span>
</code></pre>

<a href="#user-1" id="user-1" style="color: inherit; text-decoration: none;">
  <h4>User</h4>
</a>
<p>La interfaz diseñada para un usuario es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">UserDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">friends</span><span class="hl-1">: </span><span class="hl-3">UserDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-6">groups</span><span class="hl-1">: </span><span class="hl-3">GroupDocumentInterface</span><span class="hl-1">[]</span><br/><span class="hl-1">  </span><span class="hl-6">trainingStatistics</span><span class="hl-1">: </span><span class="hl-3">TrainingStatisticsInterface</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">favouriteTracks</span><span class="hl-1">: </span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-6">activeChallenges</span><span class="hl-1">: </span><span class="hl-3">ChallengeDocumentInterface</span><span class="hl-1">[];   </span><br/><span class="hl-1">  </span><span class="hl-6">tracksHistory</span><span class="hl-1">: </span><span class="hl-3">HistoryData</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code></pre>
<p>En este caso, el id de los amigos se almacena como un array de usuarios, usando la propia interfaz de usuario. Además, el tipo de actividad es el enumerado que se ha comentado anteriormente, otra cosa a resaltar es que las estadísticas de entrenamiento se almacenan como un objeto de la interfaz de estadísticas de entrenamiento comentada anteriormente. Las rutas favoritas se almacenan como un array de rutas, usando la interfaz de ruta que se ha creado y se comentará más adelante, de igual forma con los retos activos. Por último, el histórico de rutas se almacena como un array de objetos de la interfaz de histórico de rutas comentada anteriormente, que consta de un id de ruta y una fecha en la que se realizó la ruta.</p>
<p>El esquema de mongoose para este modelo es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">userSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-8">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">UserDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">enum:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-8">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },    </span><br/><span class="hl-1">  </span><span class="hl-6">friends:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">() {</span><br/><span class="hl-1">        </span><span class="hl-7">// Verificar que no haya usuarios repetidos en el array</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">existingFriends</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-8">$model</span><span class="hl-1">(</span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">).</span><span class="hl-8">countDocuments</span><span class="hl-1">({</span><br/><span class="hl-1">          </span><span class="hl-6">_id:</span><span class="hl-1"> { </span><span class="hl-6">$in:</span><span class="hl-1"> </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">friends</span><span class="hl-1"> },</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      </span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">existingFriends</span><span class="hl-1"> !== </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">friends</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid friends, some duplicated id: </span><span class="hl-2">${</span><span class="hl-4">JSON</span><span class="hl-10">.</span><span class="hl-8">stringify</span><span class="hl-10">(</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-10">)</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    }  </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">groups:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Group&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">trainingStatistics:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">TrainingStatisticsInterface</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isWeekValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isMonthValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isYearValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">isWeekValid</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">isMonthValid</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">isYearValid</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid training statistics: </span><span class="hl-2">${</span><span class="hl-4">JSON</span><span class="hl-10">.</span><span class="hl-8">stringify</span><span class="hl-10">(</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-10">)</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },  </span><br/><span class="hl-1">  </span><span class="hl-6">favouriteTracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">tracksIds</span><span class="hl-1">: </span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">[]) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">Track</span><span class="hl-1"> = </span><span class="hl-8">model</span><span class="hl-1">(</span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">trackId</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">tracksIds</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">track</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Track</span><span class="hl-1">.</span><span class="hl-8">findById</span><span class="hl-1">(</span><span class="hl-6">trackId</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">track</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">; </span><span class="hl-7">// El ID de track no existe en la base de datos</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">; </span><span class="hl-7">// Todos los IDs de track existen en la base de datos</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-6">message:</span><span class="hl-1"> </span><span class="hl-5">&#39;One or more track IDs do not exist.&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },  </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activeChallenges:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Challenge&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracksHistory:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Object</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Viendo punto por punto, comenzando por el atributo <code>name</code>, vemos que es de tipo <code>String</code>, que no es requerido, que se le aplica un <code>trim</code> para eliminar los espacios en blanco al principio y al final y que es único, osea que no puede existir un usuario en la base de datos con el mismo nombre que otro. </p>
<p>El atributo <code>activity</code> es de tipo <code>String</code>, es requerido y se le aplica una validación para que el valor sea uno de los valores del enumerado <code>Activity</code>. </p>
<p>El atributo <code>friends</code> es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de usuarios, es requerido, por defecto es un array vacío y se le aplica una validación para que no haya ids repetidos en el array y a la vez que todos los ids de usuarios existan en la base de datos.</p>
<p>El atributo <code>groups</code> es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de grupos, es requerido, por defecto es un array vacío. </p>
<p>El atributo <code>trainingStatistics</code> es de tipo <code>Object</code>, es requerido y se le aplica una validación para comprobar que tenga los atributos de la interfaz de estadísticas de entrenamiento comentada anteriormente. </p>
<p>El atributo <code>favouriteTracks</code> es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de rutas, es requerido, por defecto es un array vacío y se le aplica una validación para que todos los ids de rutas existan en la base de datos. </p>
<p>El atributo <code>activeChallenges</code> es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de retos, es requerido, por defecto es un array vacío. </p>
<p>El atributo <code>tracksHistory</code> es un array de tipo <code>Object</code>, es decir, es un array de objetos de la interfaz de histórico de rutas comentada anteriormente, es requerido y por defecto es un array vacío.</p>
<p>Por ultimo en este fichero se exporta el modelo de datos al igual que en el anterior, pero siendo este caso <code>User</code>.</p>

<a href="#group-1" id="group-1" style="color: inherit; text-decoration: none;">
  <h4>Group</h4>
</a>
<p>La interfaz de grupo que se ha diseñado es la siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">GroupDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">members</span><span class="hl-1">: </span><span class="hl-3">UserDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-6">groupStatistics</span><span class="hl-1">: </span><span class="hl-3">TrainingStatisticsInterface</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">userClasification</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">[]; </span><span class="hl-7">// usuarios ordenados por cantidad de km más el desnivel</span><br/><span class="hl-1">  </span><span class="hl-6">favouriteTracks</span><span class="hl-1">: </span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">[]; </span><span class="hl-7">// ordenado de mayor a menor en función del número de veces que se ha hecho la ruta</span><br/><span class="hl-1">  </span><span class="hl-6">tracksHistory</span><span class="hl-1">: </span><span class="hl-3">HistoryData</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code></pre>
<p>En esta, simplemente se almacena el nombre del grupo, los miembros del grupo los cuales son un array de usuarios, usando la interfaz de usuario. Las estadísticas de entrenamiento del grupo, que son un objeto de la interfaz de estadísticas de entrenamiento comentada anteriormente. La clasificación de los usuarios, que es un array de ids de usuarios ordenados por la cantidad de km más el desnivel. Las rutas favoritas del grupo, que son un array de rutas, usando la interfaz de ruta que se ha creado. Por último, el histórico de rutas se almacena como un array de objetos de la interfaz de histórico de rutas comentada anteriormente, que consta de un id de ruta y una fecha en la que se realizó la ruta.</p>
<p>En cuanto al esquema utilizado para este modelo, es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">groupSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-8">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">GroupDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">members:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">groupStatistics:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">TrainingStatisticsInterface</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isWeekValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">week</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isMonthValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">month</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isYearValid</span><span class="hl-1"> = </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1">.</span><span class="hl-6">km</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1">.</span><span class="hl-6">year</span><span class="hl-1">.</span><span class="hl-6">elevationGain</span><span class="hl-1"> === </span><span class="hl-5">&quot;number&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">isWeekValid</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">isMonthValid</span><span class="hl-1"> &amp;&amp; </span><span class="hl-6">isYearValid</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">userClasification:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Number</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">favouriteTracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracksHistory:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Object</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">default:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este podemos ver, que el atributo <code>name</code> es de tipo <code>String</code>, es requerido, se le aplica un <code>trim</code> para eliminar los espacios en blanco al principio y al final y es único, osea que no puede existir un grupo en la base de datos con el mismo nombre que otro. </p>
<p>En cuanto al atributo <code>members</code>, es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de usuarios, es requerido, por defecto es un array vacío.</p>
<p>El atributo <code>groupStatistics</code> es de tipo <code>Object</code>, es decir, es un objeto de la interfaz de estadísticas de entrenamiento comentada anteriormente, no es requerido y se le aplica una validación para asi comprobar que tenga los atributos de la interfaz de estadísticas de entrenamiento comentada anteriormente.</p>
<p>El atributo <code>userClasification</code> es un array de tipo <code>Number</code>, es decir, es un array de números, es requerido y por defecto es un array vacío.</p>
<p>El atributo <code>favouriteTracks</code> es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de rutas, es requerido, por defecto es un array vacío.</p>
<p>El atributo <code>tracksHistory</code> al igual que en modelos comentados anteriormente es un array de tipo <code>Object</code>, es decir, es un array de objetos de la interfaz de histórico de rutas comentada anteriormente, es requerido y por defecto es un array vacío.</p>
<p>Por ultimo en este fichero se exporta el modelo de datos al igual que en los anteriores, pero siendo este caso <code>Group</code>.</p>

<a href="#challenge-1" id="challenge-1" style="color: inherit; text-decoration: none;">
  <h4>Challenge</h4>
</a>
<p>Para los retos se ha diseñado la siguiente interfaz:</p>
<pre><code class="language-typescript"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">ChallengeDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">name</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">tracks</span><span class="hl-1">: </span><span class="hl-3">TrackDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-6">activity</span><span class="hl-1">: </span><span class="hl-3">Activity</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">length</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-3">UserDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Cada reto tiene un nombre, un array de rutas, usando la interfaz de ruta que se ha creado. El tipo de actividad, que es el enumerado que se ha comentado anteriormente. La longitud del reto, que es la suma de los kilómetros de las rutas que lo engloban. Por último, los usuarios que están realizando el reto, que es un array de usuarios, usando la interfaz de usuario.</p>
<p>En cuanto al esquema utilizado para este modelo, es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">challengeSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-8">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">ChallengeDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-6">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">trim:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">length:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> </span><span class="hl-6">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-8">validator</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-2">function</span><span class="hl-1">(</span><span class="hl-6">val</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">val</span><span class="hl-1"> &gt; </span><span class="hl-9">0</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-8">message</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-6">props</span><span class="hl-1"> </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-5">`Invalid length: </span><span class="hl-2">${</span><span class="hl-6">props</span><span class="hl-10">.</span><span class="hl-6">value</span><span class="hl-2">}</span><span class="hl-5">`</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">users:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;User&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">tracks:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type:</span><span class="hl-1"> [</span><span class="hl-6">Schema</span><span class="hl-1">.</span><span class="hl-6">Types</span><span class="hl-1">.</span><span class="hl-6">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Track&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">activity:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">type :</span><span class="hl-1"> </span><span class="hl-6">String</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-6">enum :</span><span class="hl-1"> </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-8">values</span><span class="hl-1">(</span><span class="hl-6">Activity</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">});</span>
</code></pre>
<p>Hay elementos comunes a los demas esquemas, como el nombre, el tipo de actividad y los usuarios que están realizando el reto, por lo que no se comentarán de nuevo. Lo único diferente en este caso es el atributo <code>tracks</code>, que es un array de tipo <code>Schema.Types.ObjectId</code>, es decir, es un array de ids de rutas, es requerido, por defecto es un array vacío y se le aplica una validación para que todos los ids de rutas existan en la base de datos.</p>
<p>Por ultimo en este fichero se exporta el modelo de datos al igual que en los anteriores, pero siendo este caso <code>Challenge</code>.</p>

<a href="#routes" id="routes" style="color: inherit; text-decoration: none;">
  <h3>Routes</h3>
</a>
<p>Para cada una de las rutas correspondientes a cada modelo de datos, se ha creado un fichero, en el que se encuentra implementadas las operaciones que se puede realizar sobre cada ruta, que son básicamente las operaciones CRUD. Cabe resaltar que todos el código de estos ficheros sigue el patrón async/await. </p>

<a href="#user-2" id="user-2" style="color: inherit; text-decoration: none;">
  <h4>User</h4>
</a>
<p>Todas las operaciones a llevar a cabo sobre los usuarios, se realizan a traves de la ruta <code>/users</code>, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Este es el mas amplio a comentar, por lo que se comentará cada una de las operaciones por separado.</p>

<a href="#post" id="post" style="color: inherit; text-decoration: none;">
  <h5>POST</h5>
</a>
<p>Esta operación se utiliza para crear un nuevo usuario, para ello se debe realizar una petición POST a la ruta <code>/users</code> con la información del usuario en el body de la petición, casi al final de este informe hay un ejemplo de como debe ser el body de la petición para cada caso.</p>
<p>Como se puede ver sigue el schema que comentamos con anterioridad, el atributo <code>name</code> es el nombre del usuario, el atributo <code>activity</code> es el tipo de actividad que realiza, el atributo <code>friends</code> es un array de ids de usuarios, el atributo <code>groups</code> es un array de ids de grupos, el atributo <code>trainingStatistics</code> es un objeto con las estadísticas de entrenamiento, el atributo <code>favouriteTracks</code> es un array de ids de rutas, el atributo <code>tracksHistory</code> es un array de objetos con el id de la ruta y la fecha en la que se realizó y por último el atributo <code>activeChallenges</code> es un array de ids de retos, cabe destacar que las id de los amigos, grupos, rutas y retos deben existir en la base de datos, además se puden omitir muchos de los atributos, ya que no son requeridos y tienen un valor por defecto.</p>
<p>En cuanto a la implementación de esta operación, se puede ver en el siguiente código:</p>
<pre><code class="language-typescript"><span class="hl-6">userRouter</span><span class="hl-1">.</span><span class="hl-8">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-8">User</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// actualizar los grupos de los que forme parte el usuario</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">groupID</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Group</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">groupID</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">members:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-7">// actualizar los usuarios de los challenge que tiene activos</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">challengeID</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">activeChallenges</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Challenge</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">challengeID</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-7">// actualizar las rutas realizadas, añadiendo el usuario a la ruta</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">trackID</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">tracksHistory</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Track</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">trackID</span><span class="hl-1">.</span><span class="hl-6">track</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-8">save</span><span class="hl-1">()</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">201</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">400</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Lo primero que es guardar en una variable el usuario que se ha pasado en el body de la petición, después se actualizan los grupos de los que forma parte el usuario recorriendo el array de ids de grupos que se ha pasado en el body de la petición, para cada uno de estos grupos se actualiza el grupo en la base de datos añadiendo el id del usuario al array de miembros del grupo. Después se actualizan los usuarios de los retos que tiene activos de la misma forma, también se actualizan las rutas realizadas, añadiendo el usuario a la ruta. Por último, se guarda el usuario en la base de datos y se devuelve el usuario creado con codigo de status 201. En caso de que haya algún error, se devuelve un error 400. </p>

<a href="#get" id="get" style="color: inherit; text-decoration: none;">
  <h5>GET</h5>
</a>
<p>Mediante el método GET se puede obtener información de los usuarios, para ello hay distintas formas de realizar la petición como se mencionó previamente, se puede consultar un usuario concreto por su nombre usando una query en la url, se puede cosultar un usuario en concreto por su id usando este como parámetro en la url o se puede consultar todos los usuarios simplemente con la ruta base <code>/users</code> utilizando este metodo.</p>
<p>El código de la implementación de esta operación es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-7">/**</span><br/><span class="hl-7"> * Get para todos los usuarios o para un usuario en específico mediante nombre usando query</span><br/><span class="hl-7"> */</span><br/><span class="hl-6">userRouter</span><span class="hl-1">.</span><span class="hl-8">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">name</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">name</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">// Find all users that match the name</span><br/><span class="hl-1">      </span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">find</span><span class="hl-1">({ </span><span class="hl-6">name</span><span class="hl-1"> }).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;friends&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;tracksHistory.track&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">// Find all users</span><br/><span class="hl-1">      </span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">find</span><span class="hl-1">().</span><span class="hl-8">populate</span><span class="hl-1">({ </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;friends&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;tracksHistory.track&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">users</span><span class="hl-1">.</span><span class="hl-6">length</span><span class="hl-1"> === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">users</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">/**</span><br/><span class="hl-7"> * Get para un usuario en específico mediante ID</span><br/><span class="hl-7"> */</span><br/><span class="hl-6">userRouter</span><span class="hl-1">.</span><span class="hl-8">get</span><span class="hl-1">(</span><span class="hl-5">&quot;/users/:id&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">userID</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">findById</span><span class="hl-1">(</span><span class="hl-6">userID</span><span class="hl-1">).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;friends&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">    ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">    ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">    ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">    ).</span><span class="hl-8">populate</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-6">path:</span><span class="hl-1"> </span><span class="hl-5">&quot;tracksHistory.track&quot;</span><span class="hl-1">, </span><span class="hl-6">select:</span><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">user</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En el primer caso, se obtiene el nombre del usuario de la query de la url, si existe se buscan todos los usuarios que coincidan con ese nombre, si no existe se buscan todos los usuarios. En ambos casos se utiliza el método <code>populate</code> para obtener información (en este caso solo el nombre) de los usuarios que son amigos, grupos, retos, rutas favoritas y rutas realizadas. En el segundo caso, se obtiene el id del usuario de los parámetros de la url, se busca el usuario con ese id. En ambos casos, si no se encuentra ningún usuario se devuelve un error 404 y si hay algún error se devuelve un error 500.</p>

<a href="#patch" id="patch" style="color: inherit; text-decoration: none;">
  <h5>PATCH</h5>
</a>
<p>Mediante el método PATCH se puede actualizar información de los usuarios, para ello hay distintas formas de realizar la petición al igual que en el método GET, además el cuerpo de la petición debe contener la información que se quiere actualizar.</p>
<p>El código de la implementación de esta operación es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-6">userRouter</span><span class="hl-1">.</span><span class="hl-8">patch</span><span class="hl-1">(</span><span class="hl-5">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">//actualizar un usaurio por su nombre</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">name</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">query</span><span class="hl-1">.</span><span class="hl-6">name</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">updates</span><span class="hl-1"> = </span><span class="hl-6">Object</span><span class="hl-1">.</span><span class="hl-8">keys</span><span class="hl-1">(</span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1"> = [</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;activity&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;friends&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;tracksHistory&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;trainingStatistics&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  ];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">isValidOperation</span><span class="hl-1"> = </span><span class="hl-6">updates</span><span class="hl-1">.</span><span class="hl-8">every</span><span class="hl-1">((</span><span class="hl-6">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-6">allowedUpdates</span><span class="hl-1">.</span><span class="hl-8">includes</span><span class="hl-1">(</span><span class="hl-6">update</span><span class="hl-1">)</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">isValidOperation</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">400</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">({ </span><span class="hl-6">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;Invalid updates!&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {            </span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-6">name</span><span class="hl-1"> }, </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">user</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-7">// recorrer updates y actualizar las demas cosas en cada caso</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">update</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">updates</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-6">update</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">          </span><span class="hl-7">// borrar de los grupos en los que es participante</span><br/><span class="hl-1">          </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Group</span><span class="hl-1">.</span><span class="hl-8">updateMany</span><span class="hl-1">({ </span><span class="hl-6">members:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> },{ </span><span class="hl-6">$pull:</span><span class="hl-1"> { </span><span class="hl-6">members:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }});</span><br/><span class="hl-1">          </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">groupID</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">groups</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Group</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">groupID</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">members:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">          </span><span class="hl-7">// borrar de los challenge en los que es participante</span><br/><span class="hl-1">          </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Challenge</span><span class="hl-1">.</span><span class="hl-8">updateMany</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> },{ </span><span class="hl-6">$pull:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }});</span><br/><span class="hl-1">          </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">challengeID</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">activeChallenges</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Challenge</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">challengeID</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&quot;tracksHistory&quot;</span><span class="hl-1">:</span><br/><span class="hl-1">          </span><span class="hl-7">// borrar de los tracks en los que es participante</span><br/><span class="hl-1">          </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Track</span><span class="hl-1">.</span><span class="hl-8">updateMany</span><span class="hl-1">({ </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> },{ </span><span class="hl-6">$pull:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }});</span><br/><span class="hl-1">          </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">track</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">body</span><span class="hl-1">.</span><span class="hl-6">tracksHistory</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">trackID</span><span class="hl-1"> = </span><span class="hl-6">track</span><span class="hl-1">.</span><span class="hl-6">track</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">Track</span><span class="hl-1">.</span><span class="hl-8">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-6">trackID</span><span class="hl-1">, { </span><span class="hl-6">$push:</span><span class="hl-1"> { </span><span class="hl-6">users:</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1">.</span><span class="hl-6">_id</span><span class="hl-1"> }}, { </span><span class="hl-6">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, </span><span class="hl-6">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">, });</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">200</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">400</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Este es el código para realizar el patch utilizando la query de la url para obtener el nombre del usuario, para el caso de usar el id es exactamente lo mismo que este pero utilizando algunas funciones buscando con el id en lugar del nombre como en el GET.</p>
<p>Primero se obtienen las claves del body de la petición, se comprueba que todas las claves sean actualizaciones válidas, se busca el usuario por el nombre y se actualiza con la información del body de la petición, devolviendo el nuevo usuario (para ello se usa la variable new en la llamada a <code>findOneAndUpdate</code>). Después se recorren las claves del body de la petición y se actualizan las demás cosas en cada caso, en el caso de los grupos, se eliminan los grupos de los que es participante y se actualizan con los nuevos grupos, en el caso de los retos, se eliminan los retos de los que es participante y se actualizan con los nuevos retos, en el caso de las rutas realizadas, se eliminan las rutas de las que es participante y se actualizan con las nuevas rutas. En caso de que no se encuentre el usuario se devuelve un error 404 y en caso de que haya algún error se devuelve un error 400, si no hay ningún error se devuelve el usuario actualizado con un código 200.</p>

<a href="#delete" id="delete" style="color: inherit; text-decoration: none;">
  <h5>DELETE</h5>
</a>
<p>Mediante el método DELETE se puede eliminar un usuario, para ello tambien hay distintas formas de realizar la petición al igual que en los métodos anteriores. </p>
<p>El código de la implementación de esta operación es el siguiente:</p>
<pre><code class="language-typescript"><span class="hl-7">/**</span><br/><span class="hl-7"> * Delete para eliminar un usuario en específico mediante ID</span><br/><span class="hl-7"> */</span><br/><span class="hl-6">userRouter</span><span class="hl-1">.</span><span class="hl-8">delete</span><span class="hl-1">(</span><span class="hl-5">&quot;/users/:id&quot;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">userID</span><span class="hl-1"> = </span><span class="hl-6">req</span><span class="hl-1">.</span><span class="hl-6">params</span><span class="hl-1">.</span><span class="hl-6">id</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">findById</span><span class="hl-1">(</span><span class="hl-6">userID</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">//const user = await User.findByIdAndDelete(req.params.id);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-6">user</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">404</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">User</span><span class="hl-1">.</span><span class="hl-8">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-6">userID</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">user</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-6">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-8">status</span><span class="hl-1">(</span><span class="hl-9">500</span><span class="hl-1">).</span><span class="hl-8">send</span><span class="hl-1">(</span><span class="hl-6">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Este es el código para borrar buscando por el id, para el caso de usar el nombre es exactamente lo mismo que este pero utilizando algunas funciones buscando con el nombre en lugar del id. </p>
<p>Primero se obtiene el id del usuario de los parámetros de la url, se busca el usuario con ese id, si no se encuentra se devuelve un error 404, si se encuentra se elimina y se devuelve el usuario eliminado con un código 200. En caso de que haya algún error se devuelve un error 500. Cabe destacar que al borrar el usuario, se eliminan las referencias a este en los grupos, retos y rutas realizadas, sin mebargo hay ciertos objetos que no se eliminan, por ejemplo cuando un id de usuario está dentro de un objeto historyData, este no se elimina.</p>

<a href="#group-2" id="group-2" style="color: inherit; text-decoration: none;">
  <h4>Group</h4>
</a>
<p>Para las operaciones sobre los grupos, se utiliza la ruta <code>/groups</code>, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). En cuanto a este, es muy similar al de los usuarios, por lo que no se comentará en detalle cada operación, para empezar el DELETE es exactamente igual, esto se repite en los demas modelos.</p>
<p>En cuanto al post lo único que cambia es lo que se actualiza, en este caso se actualizan los grupos de los usuarios que forman parte del grupo.</p>
<p>Por otro lado, el get es exactamente igual, lo que cambia es la información que se muestra con el populate, en este caso solo se muestra el nombre de los usuarios que forman parte del grupo y el nombre de las rutas favoritas del grupo.</p>
<p>Por último, el patch en gran parte también es igual, solo que las opciones validas a actualizar son diferentes y lo único que hay que tener en cuenta es que si se actualizan los miembros del grupo, se actualizan los grupos de los usuarios que forman parte del grupo.</p>

<a href="#challenge-2" id="challenge-2" style="color: inherit; text-decoration: none;">
  <h4>Challenge</h4>
</a>
<p>Para las operaciones sobre los retos, se utiliza la ruta <code>/challenges</code>, utilizando los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Este también es muy similar a los anteriores, por lo que no se comentará en detalle cada operación</p>
<p>En cuanto al post lo único que cambia es lo que se actualiza, en este caso se actualizan los retos activos de los usuarios que están realizando el reto.</p>
<p>Por otro lado, en el get lo que cambia es la información que se muestra con el populate, que en este caso solo se muestra el nombre de los usuarios que están realizando el reto y el nombre de las rutas que forman parte del reto.</p>
<p>Por último, en el patch solo cambia las opciones validas a actualizar, Cabe destacar que si se actualizan las rutas que forman parte del reto, se actualizan los retos activos de los usuarios que están realizando el reto.</p>

<a href="#track-2" id="track-2" style="color: inherit; text-decoration: none;">
  <h4>Track</h4>
</a>
<p>En este caso se utiliza la ruta <code>/tracks</code>, utilizando también los métodos HTTP referentes a cada operación CRUD (POST, GET, PATCH, DELETE). Este también es muy similar a los anteriores, por lo que no se comentará en detalle cada operación sino los cambios en cada una de ellas.</p>
<p>En cuanto al post lo único que cambia es que en este caso se actualizan las rutas favoritas de los usuarios que tienen la ruta como favorita.</p>
<p>Por otro lado, en el get lo que cambia es la información que se muestra con el populate, que en este caso solo se muestra el nombre de los usuarios que tienen la ruta como favorita.</p>
<p>Por último, en el patch cambia las opciones validas a actualizar. Lo unico a mencionar es que si se actualizan los usuarios que tienen la ruta como favorita, se actualizan las rutas favoritas de los usuarios que tienen la ruta como favorita.</p>
<p>Se debe mencionar que en el <code>delete</code> se deberían borrar las referencias a la ruta en los usuarios que la tienen dentro de su <code>tracksHistory</code>, sin embargo, esto no se ha podido realizar, ya que la base de datos no permite esto o no encontramos la forma, ya que al formar parte de un objeto con el elemento id y la fecha, conseguimos borrar la referencia al id, pero no a la fecha. y se quedaba igual el objeto pero con el id vacio y la fecha aun existiendo.</p>

<a href="#ejecución-y-ejemplos-de-uso" id="ejecución-y-ejemplos-de-uso" style="color: inherit; text-decoration: none;">
  <h2>Ejecución y ejemplos de uso</h2>
</a>
<p>Para la ejecucicón de la API, hay que seguir un procedimiento, el cual es la ejecución del servidor en MongoDB, y luego la ejecución del servidor en express o la pruebas, según lo que se desee. Los comandos son:</p>
<ul>
<li>Servidor mongodb: <code>sudo /home/usuario/mongodb/bin/mongod --dbpath /home/usuario/mongodb-data/</code></li>
<li>Servidor express: <code>npm run dev</code></li>
<li>Test: <code>npm run test</code></li>
</ul>
<p>Podremos acceder al servidor mediante la dirección http <code>http://localhost:3000</code> mediante operaciones CRUD, donde se utilizan cuerpos en formato JSON. Se ofrecen distintos ejemplos usados a lo largo del desarrollo, los cuales se pueden emplear como plantillas para hacer solicitudes (Recordar eliminar los ID porque aparecerán errores si no encuentan dichos id en la base de datos):</p>

<a href="#user-3" id="user-3" style="color: inherit; text-decoration: none;">
  <h4>User:</h4>
</a>
<pre><code class="language-typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;Aday2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;activity&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;running&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;friends&quot;</span><span class="hl-1">: [</span><span class="hl-5">&quot;645d342cf4d742296183ddb2&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;groups&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;trainingStatistics&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;week&quot;</span><span class="hl-6">:</span><span class="hl-1"> { </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">10</span><span class="hl-1">, </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">100</span><span class="hl-1">},</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;month&quot;</span><span class="hl-6">:</span><span class="hl-1"> { </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">20</span><span class="hl-1">, </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">200</span><span class="hl-1">},</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;year&quot;</span><span class="hl-6">:</span><span class="hl-1"> { </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">50</span><span class="hl-1">, </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">500</span><span class="hl-1">}</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">: [</span><span class="hl-5">&quot;645d33c8f4d742296183ddaf&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tracksHistory&quot;</span><span class="hl-1">: [ </span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;track&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-5">&quot;645d33c8f4d742296183ddaf&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;date&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-5">&quot;1987-09-28&quot;</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;activeChallenges&quot;</span><span class="hl-1">: [</span><span class="hl-5">&quot;645d33aff4d742296183ddad&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#groups" id="groups" style="color: inherit; text-decoration: none;">
  <h4>Groups:</h4>
</a>
<pre><code class="language-typescript"><span class="hl-1">{</span><br/><span class="hl-1"> </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;GrupoBrayan&quot;</span><span class="hl-1">,</span><br/><span class="hl-1"> </span><span class="hl-5">&quot;groupStatistics&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;week&quot;</span><span class="hl-6">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">10</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">100</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;month&quot;</span><span class="hl-6">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">20</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">200</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;year&quot;</span><span class="hl-6">:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;km&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">50</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;elevationGain&quot;</span><span class="hl-6">:</span><span class="hl-1"> </span><span class="hl-9">500</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;members&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;favouriteTracks&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tracksHistory&quot;</span><span class="hl-1">: []</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#challenge-3" id="challenge-3" style="color: inherit; text-decoration: none;">
  <h4>Challenge:</h4>
</a>
<pre><code class="language-typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;SergioChallenge&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tracks&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;activity&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;running&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;length&quot;</span><span class="hl-1">: </span><span class="hl-9">45</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;users&quot;</span><span class="hl-1">: []</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#track-3" id="track-3" style="color: inherit; text-decoration: none;">
  <h4>Track:</h4>
</a>
<pre><code class="language-typescript"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;Ironman&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;startCoordinates&quot;</span><span class="hl-1">: [</span><span class="hl-9">12</span><span class="hl-1">,</span><span class="hl-9">12</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;endCoordinates&quot;</span><span class="hl-1">: [</span><span class="hl-9">23</span><span class="hl-1">,</span><span class="hl-9">25</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;length&quot;</span><span class="hl-1">: </span><span class="hl-9">44</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;grade&quot;</span><span class="hl-1">: </span><span class="hl-9">6</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;users&quot;</span><span class="hl-1">:[],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;activity&quot;</span><span class="hl-1">: </span><span class="hl-5">&quot;running&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;rating&quot;</span><span class="hl-1">: </span><span class="hl-9">4.3</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#mongodbatlas-y-cyclic" id="mongodbatlas-y-cyclic" style="color: inherit; text-decoration: none;">
  <h2>MongoDBAtlas y Cyclic</h2>
</a>
<p>Mediante MongoDBAtlas y Cyclic, se ha subido la base de datos y la api a servidores que permiten su uso fuera de este entorno. Los enlaces de interes son:</p>
<ul>
<li>Base de datos en MongoDBAtlas: <code>mongodb+srv://tracks-rest-api:tracksDSI@cluster0.owwhfgp.mongodb.net/</code></li>
<li>Acceso al servidor de cyclic: <code>https://wide-eyed-plum-dungarees.cyclic.app</code></li>
</ul>

<a href="#conclusiones" id="conclusiones" style="color: inherit; text-decoration: none;">
  <h2>Conclusiones</h2>
</a>
<p>En este proyecto se ha podido ver como se puede crear un sistema de gestión de rutas de una manera más eficiente que en el primer proyecto. Se simplifica todo a la realización de distintas peticiones, las facilidades que ofrecen por ejemplo Mongoose o el validador se pueden comprobar en busca de errores y que gracias a la base de datos ofrecida por MongoDB podemos almacenar. Además, También cabe mencionar el uso de MongoDB Atlas y Cyclic, que permiten tener tanto la base de datos como el servidor en la nuve para poder acceder desde fuera del entorno  de desarrollo. Todo junto ha permitido un desarrollo solido y consistente de la API rest que se observa como resultado.</p>
<p>Al haber hecho esta práctica en grupo, también hemos observado una mejora respecto a la primera en cuanto a la velocidad de desarrollo al estar familiarizados con el entorno, lo que nos ha permitido un desarrollo más eficiente.</p>

<a href="#referencias" id="referencias" style="color: inherit; text-decoration: none;">
  <h2>Referencias</h2>
</a>
<ul>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/prct12-destravate-api/">Guión de la práctica</a></li>
<li><a href="https://ull-esit-inf-dsi-2223.github.io/nodejs-theory/">Apuntes de la asignatura</a></li>
<li><a href="https://www.mongodb.com/atlas/database">ágina de mongoDBAtlas:</a></li>
<li><a href="https://www.cyclic.sh/">Página de Cyclic</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">ULL-<wbr/>ESIT-<wbr/>INF-<wbr/>DSI-<wbr/>2223/ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>22-<wbr/>23-<wbr/>prct12-<wbr/>destravate-<wbr/>api-<wbr/>grupok</a>
<ul>
<li class="tsd-kind-module"><a href="modules/app.html">app</a></li>
<li class="tsd-kind-module"><a href="modules/db_mongoose.html">db/mongoose</a></li>
<li class="tsd-kind-module"><a href="modules/enums_activityEnum.html">enums/activity<wbr/>Enum</a></li>
<li class="tsd-kind-module"><a href="modules/index.html">index</a></li>
<li class="tsd-kind-module"><a href="modules/interfaces_historyInterface.html">interfaces/history<wbr/>Interface</a></li>
<li class="tsd-kind-module"><a href="modules/interfaces_trainingStatistics.html">interfaces/training<wbr/>Statistics</a></li>
<li class="tsd-kind-module"><a href="modules/models_challenge.html">models/challenge</a></li>
<li class="tsd-kind-module"><a href="modules/models_group.html">models/group</a></li>
<li class="tsd-kind-module"><a href="modules/models_track.html">models/track</a></li>
<li class="tsd-kind-module"><a href="modules/models_user.html">models/user</a></li>
<li class="tsd-kind-module"><a href="modules/routers_challenge.html">routers/challenge</a></li>
<li class="tsd-kind-module"><a href="modules/routers_default.html">routers/default</a></li>
<li class="tsd-kind-module"><a href="modules/routers_group.html">routers/group</a></li>
<li class="tsd-kind-module"><a href="modules/routers_track.html">routers/track</a></li>
<li class="tsd-kind-module"><a href="modules/routers_user.html">routers/user</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>